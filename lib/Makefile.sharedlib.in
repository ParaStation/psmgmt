###################################################### -*- Makefile -*- #####
#                  ParaStation
#        Copyright (c) 2002-2003 ParTec AG, Karlsruhe
#        Copyright (c) 2005 Cluster Competence Center GmbH, Munich
#############################################################################
#
# $Id$
#
# @author
#         Jens Hauke <hauke@par-tec.de>
#         Norbert Eicker <eicker@par-tec.de>
#############################################################################

CFLAGS += -O3 @CFLAG_WALL@ @CFLAG_G@ @CFLAG_COMPAT@
CPPFLAGS += $(LIBINC) @CPPFLAG_MMD@

TARGET_OS := @target_os@

_LIBDEPS := $(LIBOBJS:.o=@DEPEXTENSION@)

VPATH += $(LIBVPATH)

ifneq ("$(TARGET_OS)","osf5.1")

all: $(LIBDSTDIR)/lib$(LIBNAME).so

COMPILE.c-shared = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -fPIC -DPIC -c
%.o: %.c
	$(COMPILE.c-shared) $(OUTPUT_OPTION) $<

$(LIBDSTDIR)/lib$(LIBNAME).so: $(LIBOBJS)
	$(LD) -shared $(LIBOBJS) -o $@

clean:
	$(RM) $(_LIBDEPS) $(LIBOBJS) 

realclean: clean
	$(RM) $(LIBDSTDIR)/lib$(LIBNAME).so

-include $(_LIBDEPS)

else
# No shared libs for tru64. Maybe in the future?
all:
	@echo "Warning: No shared lib support fur tru64!"
clean realclean:
endif
