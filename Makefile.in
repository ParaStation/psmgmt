#                                                       -*- Makefile -*-
# ParaStation
#
# Copyright (C) 2002-2004 ParTec AG, Karlsruhe
# Copyright (C) 2005-2012 ParTec Cluster Competence Center GmbH, Munich
#
# This file may be distributed under the terms of the Q Public License
# as defined in the file LICENSE.QPL included in the packaging of this
# file.
#
# Authors:      Jens Hauke <hauke@par-tec.com>
#               Norbert Eicker <eicker@par-tec.com>
#

export TOP_SRCDIR = $(shell cd @srcdir@;pwd)
export TARGETARGS := --target @target_cpu@-@target_vendor@-@target_os@

SUBDIRS := lib bin include scripts doc tests/plugins tests/functional plugins

.PHONY: all install clean distclean
all install clean distclean: $(SUBDIRS)

export TARGET
install: TARGET=install
clean: TARGET=clean
distclean: TARGET=distclean

.PHONY: $(SUBDIRS)
$(SUBDIRS):
	$(MAKE) -C $@ $(TARGET)

.PHONY: test testplugins
test: testplugins
	$(MAKE) -C tests/functional test

testplugins:
	$(MAKE) -C tests/plugins plugins

export DISTPATH=/opt/parastation

.PHONY: tar rpm srpm tag version
tar rpm srpm tag version:
	mkdir -p dist
	$(MAKE) -C dist -f $(TOP_SRCDIR)/dist/Makefile $@
