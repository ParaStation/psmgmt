#                                                       -*- Makefile -*-
# ParaStation
#
# Copyright (C) 2002-2003 ParTec AG, Karlsruhe
# Copyright (C) 2005-2011 ParTec Cluster Competence Center GmbH, Munich
#
# This file may be distributed under the terms of the Q Public License
# as defined in the file LICENSE.QPL included in the packaging of this
# file.
#
# Authors:      Jens Hauke <hauke@par-tec.com>
#               Norbert Eicker <eicker@par-tec.com>
#

TARGET_LIBC_PROVIDES_SSP=@TARGET_LIBC_PROVIDES_SSP@

CFLAGS += -O3 @CFLAG_WALL@ @CFLAG_G@ @CFLAG_COMPAT@
CPPFLAGS += $(LIBINC) @CPPFLAG_MMD@

_LIBDEPS := $(LIBOBJS:.o=@DEPEXTENSION@)

VPATH += $(LIBVPATH)

all: $(LIBDSTDIR)/$(LIBNAME).so

COMPILE.c-shared = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -fPIC -DPIC
ifeq ($(TARGET_LIBC_PROVIDES_SSP),yes)
COMPILE.c-shared += -fno-stack-protector
endif
COMPILE.c-shared += -c
%.o: %.c
	$(COMPILE.c-shared) $(OUTPUT_OPTION) $<

$(LIBDSTDIR)/$(LIBNAME).so: $(LIBOBJS)
	$(CC) -shared $(LDFLAGS) $(LIBOBJS) -o $@ $(LIBEXTERNAL_SHARED) $(_LIBSONAME)

clean:
	$(RM) $(_LIBDEPS) $(LIBOBJS) 

distclean: clean
	$(RM) $(LIBDSTDIR)/$(LIBNAME).so

-include $(_LIBDEPS)
