###################################################### -*- Makefile -*- #####
#                  ParaStation3
#        Copyright (c) 2002 ParTec AG Karlsruhe
#        All rights reserved.
#############################################################################
#
# $Id: Makefile.in,v 1.2 2002/11/22 16:07:06 eicker Exp $
#
# @author
#         Jens Hauke <hauke@par-tec.de>
#############################################################################

TOP_SRCDIR := @top_srcdir@
TOP_BUILDDIR := ..

#s.o. clean:
DISTPATH := opt/parastation

DOCDIR := $(DISTPATH)/doc
DOCS = html/index.html html/adminguide html/api html/userguide
DOCS += pdf/adminguide.pdf pdf/userguide.pdf

MANDIR := $(DISTPATH)/man
MANS := man1 man3 man5 man7 man8

EXAMPLEDIR := $(DOCDIR)/examples
EXAMPLES := native.c

MISCDIR := $(DOCDIR)/html $(DOCDIR)/pdf

DIRS = $(DOCDIR) $(MANDIR) $(MISCDIR)

######################################################
all: dirs docu tar rpm

dist_doc: all

# Creating directories
$(DIRS):
	mkdir -p $@

dirs: $(DIRS)

#
# Documentation
#
docu: docs manuals examples

docs: $(DOCDIR) $(patsubst %,$(DOCDIR)/%,$(DOCS))

$(DOCDIR)/%: $(TOP_BUILDDIR)/docu/%
	cp -rp $< $@

manuals: $(MANDIR) $(patsubst %,$(MANDIR)/%,$(MANS))

$(MANDIR)/%: $(TOP_BUILDDIR)/docu/man/%
	cp -rp $< $@

examples: $(EXAMPLEDIR) $(patsubst %,$(EXAMPLEDIR)/%,$(EXAMPLES))

$(EXAMPLEDIR)/%: $(TOP_SRCDIR)/examples/%
	cp -rp $< $@

######################################################
# Create tar file

ifeq ($(DVER),)
tar rpm:
	@echo Use DVER=x.x.x to create $@ file.
else

tarcleanups:
	@echo "cleanup dirs"
	find . -name "*~" -exec rm {} \;
	@echo "change dir attribs"
	find . -type d -exec chmod 755 {} \;
	@echo "change -w flag for group and other"
	chmod -R og-w *
	@echo "change +r flag for group and other"
	chmod -R og+r *

tar:	tarcleanups
	tar --owner=0 --group=0 -czf \
		ps-doc-$(DVER)-`date +%Y%m%d`.tar.gz $(DISTPATH)

rpm:	tarcleanups
	$(TOP_SRCDIR)/scripts/rpmbuilddoc $(DVER)

endif
DISTCLEAN+= ps-doc*.tar.gz
DISTCLEAN+= ps-doc*.rpm
DISTCLEAN+= ps-doc*.spec


######################################################
clean:
	rm -rf opt/parastation

distclean: clean
	$(RM) $(DISTCLEAN)
